<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Differentiation API · RobotDynamics</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">RobotDynamics</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Dynamics Models</span><ul><li><a class="tocitem" href="continuous.html">Continuous Dynamics</a></li><li><a class="tocitem" href="discrete.html">Discrete Dynamics</a></li></ul></li><li><span class="tocitem">Rotations</span><ul><li><a class="tocitem" href="rotationstate.html">The Rotation State</a></li></ul></li><li><span class="tocitem">Important Types</span><ul><li><a class="tocitem" href="knotpoints.html">Knot Points</a></li><li><a class="tocitem" href="trajectories.html">Trajectories</a></li></ul></li><li><span class="tocitem">Internal API</span><ul><li><a class="tocitem" href="functionbase.html"><code>AbstractFunction</code> API</a></li><li><a class="tocitem" href="scalarfunction.html">Scalar Functions</a></li><li class="is-active"><a class="tocitem" href="autodiff.html">Differentiation API</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internal API</a></li><li class="is-active"><a href="autodiff.html">Differentiation API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="autodiff.html">Differentiation API</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RoboticExplorationLab/RobotDynamics.jl/blob/master/docs/src/autodiff.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Differentiation-API-1"><a class="docs-heading-anchor" href="#Differentiation-API-1">Differentiation API</a><a class="docs-heading-anchor-permalink" href="#Differentiation-API-1" title="Permalink"></a></h1><p>RobotDynamics allows users to define different methods for obtaining derivatives of their  functions. This is accomplished via the <a href="functionbase.html#RobotDynamics.DiffMethod"><code>DiffMethod</code></a> trait, which by default  has three options:</p><ul><li><code>ForwardAD</code>: forward-mode automatic differentiation using   <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a></li><li><code>FiniteDifference</code>: finite difference approximation using   <a href="https://github.com/JuliaDiff/FiniteDiff.jl">FiniteDiff.jl</a></li><li><code>UserDefined</code>: analytical function defined by the user.</li></ul><p>Almost every Jacobian is queried using the same form:</p><pre><code class="language-none">jacobian!(sig, diff, fun, J, y, z)</code></pre><p>where <code>sig</code> is a <a href="functionbase.html#RobotDynamics.FunctionSignature"><code>FunctionSignature</code></a>, <code>diff</code> is a <a href="functionbase.html#RobotDynamics.DiffMethod"><code>DiffMethod</code></a>, <code>fun</code> is  an <a href="functionbase.html#RobotDynamics.AbstractFunction"><code>AbstractFunction</code></a>, <code>J</code> is the Jacobian, <code>y</code> is a vector the size of the  output of the function, and <code>z</code> is an [<code>AbstractKnotPoint</code>]. Users are free to add more  <a href="functionbase.html#RobotDynamics.DiffMethod"><code>DiffMethod</code></a> types to dispatch on their own differentiation method. </p><p>By default, no differentiation methods are provided for an <a href="functionbase.html#RobotDynamics.AbstractFunction"><code>AbstractFunction</code></a>,  allowing the user to choose what methods they want defined, and to allow customization  of the particular method to their function. However, we do provide the following macro  to provide efficient implementations for <code>ForwardAD</code> and <code>FiniteDifference</code>:</p><article class="docstring"><header><a class="docstring-binding" id="RobotDynamics.@autodiff" href="#RobotDynamics.@autodiff"><code>RobotDynamics.@autodiff</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia">@autodef struct_def</code></pre><p>Sets up methods to automatically evaluate the Jacobian of the function. By default, it defines these methods for a new type <code>NewFun</code>:</p><pre><code class="language-none">jacobian!(::InPlace, ::ForwardAD, fun::NewFun, J, y, z)
jacobian!(::InPlace, ::FiniteDifference, fun::NewFun, J, y, z)
jacobian!(::StaticReturn, ::ForwardAD, fun::NewFun, J, y, z)
jacobian!(::StaticReturn, ::FiniteDifference, fun::NewFun, J, y, z)</code></pre><p>These methods are all optimized to be non-allocating.</p><p>The method will modify the type definition, adding fields and type parameters to set them  up for efficient evaluation of the jacobians. The changes are usually transparent to the user.</p><p>If an inner constructor is provided, the signature will be unchanged, but will be modified to initialize the new fields and provide the new type parameters.</p><p><strong>Limitations</strong></p><ul><li><code>RobotDynamics</code> must be defined the local module (cannot be hidden by an alias)</li><li>ForwardDiff and FiniteDiff must both be defined in the local module, since the  struct is modified to include caches from these modules.</li><li>If the type has type parameters and no inner constructor, the type parameters must be  explicitly provided when constructing the object. No automatic inference will be done. It&#39;s best to explicitly provide an inner constructor with the desired behavior.</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia">using RobotDynamics, ForwardDiff, FiniteDiff
const RD = RobotDynamics
RD.@autodiff struct MyFun &lt;: RD.AbstractFunction end</code></pre><p>will define</p><pre><code class="language-julia">struct MyFun{CH} &lt;: RobotDynamics.AbstractFunction
    cfg::ForwardDiff.JacobianConfig{Nothing, Float64, CH, Tuple{Vector{ForwardDiff.Dual{Nothing, Float64, CH}}, Vector{(ForwardDiff).Dual{Nothing, Float64, CH}}}}
    cache::FiniteDiff.JacobianCache{Vector{Float64}, Vector{Float64}, Vector{Float64}, UnitRange{Int64}, Nothing, Val{:forward}(), Float64}
    function MyFun()
        model = new{0}()
        _n = input_dim(model)
        _m = output_dim(model)
        cfg = ForwardDiff.JacobianConfig(nothing, zeros(Float64, _m), zeros(Float64, _n))
        model = new{length(cfg).seeds}(cfg)
        _n = input_dim(model)
        _m = output_dim(model)
        cache = FiniteDiff.JacobianCache(zeros(Float64, _n), zeros(Float64, _m))
        model = new{length(cfg).seeds}(cfg, cache)
    end
end

function RobotDynamics.jacobian!(::InPlace, ::ForwardAD, fun::MyFun, J, y, z)
    f_aug!(y, z_) = begin
        RobotDynamics.evaluate!(fun, y, RobotDynamics.setinputs!(z, z_))
        ForwardDiff.jacobian!(J, f_aug!, y, z, fun.cfg)
    end
end
...  # other Jacobian methods</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/RobotDynamics.jl/blob/103d4f663ee12b44229f0567645b14d0a528bc94/src/jacobian_gen.jl#L1-L63">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="scalarfunction.html">« Scalar Functions</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 2 March 2022 14:27">Wednesday 2 March 2022</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
